(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{ohN5:function(e,t,i){"use strict";i.r(t),i.d(t,"ForecastingModule",(function(){return pe}));var n=i("tyNb"),l=i("J7oY"),s=i("JSOo"),o=i("OBQ6"),c=i("PCNd"),a=i("Mf/S"),r=i("fXoL"),h=i("7CaW"),d=i("7zfz"),g=i("arFO"),u=i("3Pt+"),f=i("ofXK"),p=i("Y+ZO"),m=i("rEr+"),b=i("+07z"),C=i("TjhJ"),D=i("fyqy"),V=i("pqzn");function S(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div"),r.Vb(1,"div",32),r.dc("onDragStart",(function(){r.Dc(e);const t=r.gc().index;return r.gc(2).onDragStart(t)}))("onDrop",(function(){r.Dc(e);const t=r.gc().index;return r.gc(2).onDrop(t)})),r.Vb(2,"div",33),r.Vb(3,"input",34),r.dc("ngModelChange",(function(t){return r.Dc(e),r.gc().$implicit.showField=t}))("change",(function(){r.Dc(e);const t=r.gc().$implicit;return r.gc(2).selectColumns(t)})),r.Ub(),r.Vb(4,"label"),r.Mc(5),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc().$implicit;r.Eb(3),r.oc("checked",e.showField)("ngModel",e.showField),r.Eb(2),r.Nc(e.header)}}const y=function(){return{color:"grey"}};function w(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div"),r.Vb(1,"div",35),r.Vb(2,"div"),r.Vb(3,"input",36),r.dc("ngModelChange",(function(t){return r.Dc(e),r.gc().$implicit.showField=t}))("change",(function(){r.Dc(e);const t=r.gc().$implicit;return r.gc(2).selectColumns(t)})),r.Ub(),r.Vb(4,"label",37),r.Mc(5),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc().$implicit;r.Eb(3),r.oc("checked",e.showField)("ngModel",e.showField)("disabled",!e.drag),r.Eb(1),r.oc("ngStyle",r.rc(5,y)),r.Eb(1),r.Nc(e.header)}}function R(e,t){if(1&e&&(r.Kc(0,S,6,3,"div",31),r.Kc(1,w,6,6,"div",31)),2&e){const e=t.$implicit;r.oc("ngIf",e.drag),r.Eb(1),r.oc("ngIf",!e.drag)}}const A=function(){return{width:"100%",height:"100%"}};function T(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",20),r.Vb(1,"div",21),r.Vb(2,"div",22),r.Vb(3,"input",23),r.dc("click",(function(){return r.Dc(e),r.gc().onSelectAll()})),r.Ub(),r.Vb(4,"label",24),r.Mc(5,"Select All"),r.Ub(),r.Vb(6,"a",25),r.dc("click",(function(t){return r.Dc(e),r.gc().closeConfigureColumns(t)})),r.Mc(7,"\xd7"),r.Ub(),r.Vb(8,"p-listbox",26),r.Kc(9,R,2,2,"ng-template",27),r.Ub(),r.Ub(),r.Vb(10,"div",28),r.Vb(11,"a",29),r.dc("click",(function(){return r.Dc(e),r.gc().saveColumns()})),r.Mc(12,"Save"),r.Ub(),r.Vb(13,"a",30),r.dc("click",(function(t){return r.Dc(e),r.gc().closeConfigureColumns(t)})),r.Mc(14,"Cancel"),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc();r.Eb(3),r.oc("checked",e.isSelectAllChecked),r.Eb(5),r.Ic(r.rc(4,A)),r.oc("options",e.globalCols)}}function F(e,t){1&e&&r.Qb(0,"col")}function v(e,t){if(1&e&&(r.Vb(0,"colgroup"),r.Kc(1,F,1,0,"col",38),r.Ub()),2&e){const e=t.$implicit;r.Eb(1),r.oc("ngForOf",e)}}function k(e,t){if(1&e&&(r.Vb(0,"th",40),r.Vb(1,"a"),r.Mc(2),r.Ub(),r.Ub()),2&e){const e=t.$implicit;r.Eb(2),r.Oc(" ",e.header," ")}}function E(e,t){if(1&e&&(r.Vb(0,"tr"),r.Kc(1,k,3,1,"th",39),r.Ub()),2&e){const e=r.gc();r.Eb(1),r.oc("ngForOf",e.columns)}}function M(e,t){if(1&e&&(r.Tb(0),r.Mc(1),r.hc(2,"roundCurrency"),r.Sb()),2&e){const e=r.gc().$implicit,t=r.gc().$implicit;r.Eb(1),r.Oc(" ",r.jc(2,1,t[e.field],t.Currency)," ")}}function U(e,t){if(1&e&&(r.Mc(0),r.hc(1,"round")),2&e){const e=r.gc().$implicit,t=r.gc().$implicit,i=r.gc();r.Oc(" ","number"===i.fieldType(t[e.field])?r.ic(1,1,t[e.field]):t[e.field]," ")}}function I(e,t){if(1&e&&(r.Vb(0,"td"),r.Vb(1,"span",42),r.Kc(2,M,3,4,"ng-container",43),r.Kc(3,U,2,3,"ng-template",null,44,r.Lc),r.Ub(),r.Ub()),2&e){const e=t.$implicit,i=r.Bc(4),n=r.gc().$implicit,l=r.gc();r.Eb(1),r.pc("title",n[e.field]),r.Eb(1),r.oc("ngIf",l.isCurrencyField(e.field)&&null!=n[e.field])("ngIfElse",i)}}function x(e,t){if(1&e&&(r.Vb(0,"tr",41),r.Kc(1,I,5,3,"td",38),r.Ub()),2&e){const e=t.$implicit,i=r.gc();r.oc("pSelectableRow",e),r.Eb(1),r.oc("ngForOf",i.columns)}}function P(e,t){if(1&e&&(r.Vb(0,"div",45),r.Vb(1,"p"),r.Mc(2),r.Ub(),r.Ub()),2&e){const e=r.gc();r.Eb(2),r.Nc(e.noData)}}const O=function(){return{"margin-bottom":"20px"}},L=function(){return{"margin-left":"-110px",position:"absolute",height:"31px",padding:"0px",width:"100px","margin-top":"-3px"}},Q=function(){return{"margin-left":"10px",position:"relative",top:"-2px"}},N=i("+yMW");let K=(()=>{class e{constructor(e,t,i,l,s){this.rmanDealRfcstVService=e,this.router=t,this.commonSharedService=i,this.notificationService=l,this.rmanLookupsVService=s,this.rmanDealRfcstV=new B,this.rmanDealRfcstVSearch=new B,this.isSerached=0,this.noData=N.noData,this.paginationOptions={},this.showAddColumns=!0,this.isSelectAllChecked=!0,this.showPaginator=!0,this.collapsed=!0,this.columns=[],this.isTCSelected=!0,this.sourceTypesList=[],this.srcType="Q",this.isPeriodTypeSelected=!0,this.hideColumnMenu=!0,this.showFilter=!1,this.paginationOptions={pageNumber:0,pageSize:10},this.router.events.subscribe(e=>{e instanceof n.c&&(this.arrIdK=e.url.split("/")[3])}),this.rmanLookupsVService.getAllRmanLookupsV(this.paginationOptions,{lookupTypeName:"FORECAST_DOCUMENT_TYPE"}).then(e=>{this.sourceTypesList=e.content.map(e=>({label:e.lookupCode,value:e.lookupDescription}))})}ngOnInit(){this.getDealForecastingView()}onToggleTCFC(){this.getDealForecastingView()}onTogglePeriodType(){this.getDealForecastingView()}checkIfStringStartsWith(e,t){return t.some(t=>e.startsWith(t)||e.endsWith(t))}getTableColumns(e,t){this.isSelectAllChecked=!0;const i=["Q1-","Q2-","Q3-","Q4-","-Q1","-Q2","-Q3","-Q4","Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"];this.commonSharedService.getConfiguredColDetails(e,t).then(e=>{if(e&&null!=e&&e.userId){this.columns=[];let t=e.tableColumns.split(",");t.length>0&&t.forEach((e,t)=>{e&&(this.startIndex=this.globalCols.findIndex(t=>t.field==e),this.onDrop(t))}),this.globalCols.forEach(t=>{-1!==e.tableColumns.indexOf(t.field)||1==this.checkIfStringStartsWith(t.field,i)?this.columns.push(t):t.showField=!1}),this.columns.length!=this.globalCols.length&&(this.isSelectAllChecked=!1),this.showPaginator=0!==this.columns.length,this.userId=e.userId}else this.columns=this.globalCols}).catch(()=>{this.notificationService.showError("Error occured while getting table columns data"),this.loading=!1})}saveColumns(){let e="";this.showAddColumns=!this.showAddColumns;const t=this.globalCols.length-1;this.globalCols.forEach((i,n)=>{i.showField&&0==this.checkIfStringStartsWith(i.field,["Q1-","Q2-","Q3-","Q4-","-Q1","-Q2","-Q3","-Q4","Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"])&&(e+=i.field,n<t&&(e+=","))}),this.loading=!0,this.commonSharedService.saveOrUpdateTableColumns("rmanDealForecasting","Forecasting Details",e,this.userId).then(e=>{this.columns=this.globalCols.filter(e=>e.showField),this.userId=e.userId,this.showPaginator=0!==this.columns.length,this.loading=!1}).catch(()=>{this.notificationService.showError("Error occured while saving"),this.loading=!1})}onDragStart(e){this.startIndex=e}onDrop(e){const t=this.globalCols[this.startIndex];this.globalCols.splice(this.startIndex,1),this.globalCols.splice(e,0,t)}selectColumns(e){let t=this.globalCols.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}onSelectAll(){this.isSelectAllChecked=!this.isSelectAllChecked,this.globalCols.forEach(e=>{this.isSelectAllChecked?e.showField=!0:e.drag&&(e.showField=!1)})}onConfiguringColumns(e){this.clonedCols=JSON.parse(JSON.stringify(this.globalCols)),this.showAddColumns=!1}closeConfigureColumns(e){this.showAddColumns=!0,this.globalCols=this.clonedCols;let t=this.globalCols.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}isDealPage(){return this.router.url.includes("deal-manager")}reset(e){e.reset(),this.paginationOptions={},this.rmanDealRfcstV=new B,this.getDealForecastingView()}exportExcel(){let e=this.rmanDealRfcstVService.getServiceUrl(this.paginationOptions,{arrangementId:this.arrIdK},1);window.location.href=e}getAllRmanDealRfcstV(){this.loading=!0,this.rmanDealRfcstVService.getAllRmanDealRfcstV(this.paginationOptions,{arrangementId:this.arrIdK}).then(e=>{this.datasource=e.content,this.rmanDealRfcstVList=e.content,this.loading=!1,this.totalElements=e.totalElements,this.pageSize=e.size,this.displaySearchDialog=!1}).catch(e=>{this.notificationService.showError("Error occured while getting data"),this.loading=!1})}onSourceTypeChange(){this.getDealForecastingView()}getDealForecastingView(){this.loading=!0,this.rmanDealRfcstVService.getRmanForecastView2(this.arrIdK,this.isTCSelected,this.srcType,this.isPeriodTypeSelected).then(e=>{this.rDealFCSTViewList=e.Content,this.globalCols=[],this.loading=!1;let t=this.rDealFCSTViewList[0];for(let i in t)["Element Type"].includes(i)||["Arrangement Number","SKU"].includes(i)||["Expected Booking Amount"].includes(i)?this.globalCols.push({field:i,header:i,hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Expected Start Date"].includes(i)?this.globalCols.push({field:i,header:"Forecast Date",hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Ayara Line Id"].includes(i)||["Quote Line Id"].includes(i)||(["Line No"].includes(i)?this.globalCols.push({field:i,header:"Line Number",hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Parent Line No"].includes(i)?this.globalCols.push({field:i,header:"Parent Line Number",hide:!1,showField:!0,drag:!0,display:"table-cell"}):this.globalCols.push({field:i,header:i,hide:!1,showField:!0,drag:!0,display:"table-cell"}));this.columns=[],this.getTableColumns("rmanDealForecasting","Forecasting Details"),this.rDealFCSTViewList=e.Content,this.totalRecords=this.rDealFCSTViewList.length,$.unblockUI()}).catch(e=>{this.loading=!1,this.notificationService.showError("Error occured while getting data"),$.unblockUI()})}fieldType(e){return typeof e}showDialogToAdd(){this.newRmanDealRfcstV=!0,this.rmanDealRfcstV=new B,this.displayDialog=!0}save(){this.newRmanDealRfcstV?(this.loading=!0,this.rmanDealRfcstVService.saveRmanDealRfcstV(this.rmanDealRfcstV).then(e=>{this.getAllRmanDealRfcstV()}).catch(e=>{this.notificationService.showError("Error occured while saving the data"),this.loading=!1})):(this.loading=!0,this.rmanDealRfcstVService.updateRmanDealRfcstV(this.rmanDealRfcstV).then(e=>{this.getAllRmanDealRfcstV()}).catch(e=>{this.notificationService.showError("Error occured while updating the data"),this.loading=!1})),this.rmanDealRfcstV=new B,this.displayDialog=!1}delete(e){this.rmanDealRfcstV=e,this.displayDialog=!1,window.confirm("Are you sure you want to delete this record?")&&(this.rmanDealRfcstVList.splice(this.findSelectedRmanDealRfcstVIndex(),1),this.rmanDealRfcstVService.deleteRmanDealRfcstV(this.rmanDealRfcstV).then(e=>{this.rmanDealRfcstV=new B,this.getAllRmanDealRfcstV()}))}editRow(e){this.newRmanDealRfcstV=!1,this.rmanDealRfcstV=this.cloneRmanDealRfcstV(e),this.displayDialog=!0}findSelectedRmanDealRfcstVIndex(){return this.rmanDealRfcstVList.indexOf(this.selectedRmanDealRfcstV)}onRowSelect(e){}cloneRmanDealRfcstV(e){let t=new B;for(let i in e)t[i]=e[i];return t}toggleColumnMenu(){this.hideColumnMenu=!this.hideColumnMenu}toggleFilterBox(){this.showFilter=!this.showFilter}showDialogToSearch(){this.rmanDealRfcstVSearch=new B,0==this.isSerached&&(this.rmanDealRfcstVSearch=new B),this.displaySearchDialog=!0}search(){this.isSerached=1,this.rmanDealRfcstV=this.rmanDealRfcstVSearch,this.getAllRmanDealRfcstV()}onBeforeToggle(e){this.collapsed=e.collapsed}isCurrencyField(e){return["Unit Net Price","Net Price","Allocation Amount","Extended List Price"].includes(e)||/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{2}$/.test(e)||/^\d{4}-Q[1-4]$/.test(e)}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(o.a),r.Pb(n.g),r.Pb(s.a),r.Pb(l.a),r.Pb(a.a))},e.\u0275cmp=r.Jb({type:e,selectors:[["rmanDealRfcstV-data"]],features:[r.Db([o.a,c.a])],decls:22,vars:22,consts:[[1,"content-section","implementation"],[3,"header","onBeforeToggle"],[1,"pull-right","icons-list"],["placeholder","Select Source Type","appendTo","body",3,"options","ngModel","filter","ngStyle","ngModelChange","onChange"],["onLabel","Monthly","offLabel","Quarterly","onIcon","fa fa-toggle-on fa-sm","offIcon","fa fa-toggle-off fa-sm",1,"ui-inputswitch",3,"ngStyle","ngModel","ngModelChange"],["onLabel","TC","offLabel","FC","onIcon","fa fa-toggle-on fa-sm","offIcon","fa fa-toggle-off fa-sm",1,"ui-inputswitch",3,"ngStyle","ngModel","ngModelChange"],[1,"add-column",3,"click"],[1,"fa","fa-cog"],["title","Reset",3,"click"],[1,"fa","fa-refresh"],["title","Export",3,"click"],[1,"fa","fa-external-link"],["id","add-column-popup","class","contracts_add_column",4,"ngIf"],[1,"x-scroll"],["exportFilename","RmanDealRfcstV","columnResizeMode","expand","scrollable","true",1,"ui-datatable","arrangementMgrTbl",3,"columns","loading","value","paginator","rows","resizableColumns"],["dt",""],["pTemplate","colgroup"],["pTemplate","header","class","arrangementMgrTblHead"],["pTemplate","body"],["pTemplate","emptymessage"],["id","add-column-popup",1,"contracts_add_column"],[1,"user-popup"],[1,"content","overflow"],["type","checkbox","id","selectall","name","selectall",3,"checked","click"],["for","selectall"],["title","Close",1,"close",3,"click"],[3,"options"],["pTemplate","item"],[1,"pull-right"],[1,"configColBtn",3,"click"],[1,"configColBtn","conf-cancel",3,"click"],[4,"ngIf"],["pDraggable","gens","pDroppable","gens",1,"ui-helper-clearfix",3,"onDragStart","onDrop"],[1,"drag"],["type","checkbox",3,"checked","ngModel","ngModelChange","change"],[1,"ui-helper-clearfix"],["type","checkbox",3,"checked","ngModel","disabled","ngModelChange","change"],[3,"ngStyle"],[4,"ngFor","ngForOf"],["pResizableColumn","",4,"ngFor","ngForOf"],["pResizableColumn",""],[3,"pSelectableRow"],[3,"title"],[4,"ngIf","ngIfElse"],["normalText",""],[1,"no-results-data"]],template:function(e,t){if(1&e){const e=r.Wb();r.Qb(0,"div",0),r.Vb(1,"p-panel",1),r.dc("onBeforeToggle",(function(e){return t.onBeforeToggle(e)})),r.Vb(2,"p-header"),r.Vb(3,"div",2),r.Vb(4,"p-dropdown",3),r.dc("ngModelChange",(function(e){return t.srcType=e}))("onChange",(function(){return t.onSourceTypeChange()})),r.Ub(),r.Vb(5,"p-toggleButton",4),r.dc("ngModelChange",(function(e){return t.isPeriodTypeSelected=e}))("ngModelChange",(function(){return t.onTogglePeriodType()})),r.Ub(),r.Vb(6,"p-toggleButton",5),r.dc("ngModelChange",(function(e){return t.isTCSelected=e}))("ngModelChange",(function(){return t.onToggleTCFC()})),r.Ub(),r.Vb(7,"a",6),r.dc("click",(function(e){return t.onConfiguringColumns(e)})),r.Qb(8,"em",7),r.Mc(9,"Columns"),r.Ub(),r.Vb(10,"a",8),r.dc("click",(function(){r.Dc(e);const i=r.Bc(17);return t.reset(i)})),r.Qb(11,"em",9),r.Ub(),r.Vb(12,"a",10),r.dc("click",(function(){return r.Dc(e),r.Bc(17).exportCSV()})),r.Qb(13,"em",11),r.Ub(),r.Kc(14,T,15,5,"div",12),r.Ub(),r.Ub(),r.Vb(15,"div",13),r.Vb(16,"p-table",14,15),r.Kc(18,v,2,1,"ng-template",16),r.Kc(19,E,2,1,"ng-template",17),r.Kc(20,x,2,2,"ng-template",18),r.Kc(21,P,3,1,"ng-template",19),r.Ub(),r.Ub(),r.Ub()}2&e&&(r.Eb(1),r.Ic(r.rc(18,O)),r.oc("header",t.isDealPage()?"":"Deal Forecasting View"),r.Eb(3),r.oc("options",t.sourceTypesList)("ngModel",t.srcType)("filter",!0)("ngStyle",r.rc(19,L)),r.Eb(1),r.oc("ngStyle",r.rc(20,Q))("ngModel",t.isPeriodTypeSelected),r.Eb(1),r.oc("ngStyle",r.rc(21,Q))("ngModel",t.isTCSelected),r.Eb(8),r.oc("ngIf",!t.showAddColumns),r.Eb(2),r.oc("columns",t.columns)("loading",t.loading)("value",t.rDealFCSTViewList)("paginator",!0)("rows",10)("resizableColumns",!0))},directives:[h.a,d.c,g.a,u.k,u.n,f.p,p.a,f.o,m.j,d.f,b.a,C.b,C.c,u.a,f.n,m.g,m.i],pipes:[D.a,V.a],encapsulation:2}),e})();class B{constructor(e,t,i,n,l,s,o,c,a,r){this.glPeriod=e,this.expectedBookingAmount=t,this.amount=i,this.qty=n,this.netPrice=l,this.elementType=s,this.startDate=o,this.arrangementName=c,this.sku=a,this.arrangementId=r}}var J=i("tk/3"),_=i("MCLT");const z=i("+yMW"),W={headers:new J.f({"Content-Type":"application/json"})};let j=(()=>{class e{constructor(e){this.http=e}getServiceUrl(e,t,i){let n=z.apiUrl+"/rmanDealRfcstVExport?";0==i&&(n=z.apiUrl+"/rmanDealRfcstVSearch?");let l="";return null!=t.arrangementId&&""!=t.arrangementId&&(l=l+"arrangementId:"+t.arrangementId),null!=t.arrangementName&&""!=t.arrangementName&&(l=l+"arrangementName:"+t.arrangementName+","),null!=t.sku&&""!=t.sku&&(l=l+"sku:"+t.sku+","),null!=t.qty&&""!=t.qty&&(l=l+"qty:"+t.qty+","),null!=t.elementType&&""!=t.elementType&&(l=l+"elementType:"+t.elementType+","),null!=t.netPrice&&""!=t.netPrice&&(l=l+"netPrice:"+t.netPrice+","),null!=t.expectedBookingAmount&&""!=t.expectedBookingAmount&&(l=l+"expectedBookingAmount:"+t.expectedBookingAmount+","),null!=t.amount&&""!=t.amount&&(l=l+"amount:"+t.amount+","),null!=t.glPeriod&&""!=t.glPeriod&&(l=l+"glPeriod:"+t.glPeriod+","),null!=t.startDate&&""!=t.startDate&&(l=l+"startDate:"+t.startDate),""==l?n+="search=%25":n=n+"search="+l,Object(_.isNumber)(e.pageNumber)&&(console.log(!0),n=n+"&page="+e.pageNumber+"&size="+e.pageSize),n}getAllRmanDealRfcstAnalysisV(e,t){let i=this.getServiceUrl(e,t,0);return this.http.get(i).toPromise().then(e=>e)}saveRmanDealRfcstAnalysisV(e){let t=JSON.stringify(e);return this.http.post(z.apiUrl+"/RMAN_DEAL_RFCST_V",t,W).toPromise().then(e=>e)}updateRmanDealRfcstAnalysisV(e){delete e._links,delete e.interests;let t=JSON.stringify(e);return this.http.put(z.apiUrl+"/RMAN_DEAL_RFCST_V/"+e.arrangementId,t,W).toPromise().then(e=>e)}deleteRmanDealRfcstV(e){return this.http.delete(z.apiUrl+"/RMAN_DEAL_RFCST_V/"+e.arrangementId,W).toPromise().then(e=>e)}getRmanForecastAnalysisView(e){return null==e&&(e=0),this.http.get(z.apiUrl+"/revmantra/rfcstView?arrgId="+e).toPromise().then(e=>e)}getRmanForecastAnalysisView2(e,t,i,n){return null==e&&(e=0),this.http.get(z.apiUrl+"/revmantra/rfcstActualView?arrgId="+e+"&currType="+(t=t?"TC":"FC")+"&periodType="+(i=i?"M":"Q")).toPromise().then(e=>e)}}return e.\u0275fac=function(t){return new(t||e)(r.Zb(J.b))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac}),e})();function q(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div"),r.Vb(1,"div",31),r.dc("onDragStart",(function(){r.Dc(e);const t=r.gc().index;return r.gc(2).onDragStart(t)}))("onDrop",(function(){r.Dc(e);const t=r.gc().index;return r.gc(2).onDrop(t)})),r.Vb(2,"div",32),r.Vb(3,"input",33),r.dc("ngModelChange",(function(t){return r.Dc(e),r.gc().$implicit.showField=t}))("change",(function(){r.Dc(e);const t=r.gc().$implicit;return r.gc(2).selectColumns(t)})),r.Ub(),r.Vb(4,"label"),r.Mc(5),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc().$implicit;r.Eb(3),r.oc("checked",e.showField)("ngModel",e.showField),r.Eb(2),r.Nc(e.header)}}const Y=function(){return{color:"grey"}};function H(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div"),r.Vb(1,"div",34),r.Vb(2,"div"),r.Vb(3,"input",35),r.dc("ngModelChange",(function(t){return r.Dc(e),r.gc().$implicit.showField=t}))("change",(function(){r.Dc(e);const t=r.gc().$implicit;return r.gc(2).selectColumns(t)})),r.Ub(),r.Vb(4,"label",36),r.Mc(5),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc().$implicit;r.Eb(3),r.oc("checked",e.showField)("ngModel",e.showField)("disabled",!e.drag),r.Eb(1),r.oc("ngStyle",r.rc(5,Y)),r.Eb(1),r.Nc(e.header)}}function X(e,t){if(1&e&&(r.Kc(0,q,6,3,"div",30),r.Kc(1,H,6,6,"div",30)),2&e){const e=t.$implicit;r.oc("ngIf",e.drag),r.Eb(1),r.oc("ngIf",!e.drag)}}const Z=function(){return{width:"100%",height:"100%"}};function G(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",19),r.Vb(1,"div",20),r.Vb(2,"div",21),r.Vb(3,"input",22),r.dc("click",(function(){return r.Dc(e),r.gc().onSelectAll()})),r.Ub(),r.Vb(4,"label",23),r.Mc(5,"Select All"),r.Ub(),r.Vb(6,"a",24),r.dc("click",(function(t){return r.Dc(e),r.gc().closeConfigureColumns(t)})),r.Mc(7,"\xd7"),r.Ub(),r.Vb(8,"p-listbox",25),r.Kc(9,X,2,2,"ng-template",26),r.Ub(),r.Ub(),r.Vb(10,"div",27),r.Vb(11,"a",28),r.dc("click",(function(){return r.Dc(e),r.gc().saveColumns()})),r.Mc(12,"Save"),r.Ub(),r.Vb(13,"a",29),r.dc("click",(function(t){return r.Dc(e),r.gc().closeConfigureColumns(t)})),r.Mc(14,"Cancel"),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=r.gc();r.Eb(3),r.oc("checked",e.isSelectAllChecked),r.Eb(5),r.Ic(r.rc(4,Z)),r.oc("options",e.globalCols)}}function ee(e,t){1&e&&r.Qb(0,"col")}function te(e,t){if(1&e&&(r.Vb(0,"colgroup"),r.Kc(1,ee,1,0,"col",37),r.Ub()),2&e){const e=t.$implicit;r.Eb(1),r.oc("ngForOf",e)}}function ie(e,t){if(1&e&&(r.Vb(0,"th",39),r.Vb(1,"a"),r.Mc(2),r.Ub(),r.Ub()),2&e){const e=t.$implicit;r.Eb(2),r.Oc(" ",e.header," ")}}function ne(e,t){if(1&e&&(r.Vb(0,"tr"),r.Kc(1,ie,3,1,"th",38),r.Ub()),2&e){const e=r.gc();r.Eb(1),r.oc("ngForOf",e.columns)}}function le(e,t){if(1&e&&(r.Tb(0),r.Mc(1),r.hc(2,"roundCurrency"),r.Sb()),2&e){const e=r.gc().$implicit,t=r.gc().$implicit;r.Eb(1),r.Oc(" ",r.jc(2,1,t[e.field],t.Currency)," ")}}function se(e,t){if(1&e&&(r.Mc(0),r.hc(1,"round")),2&e){const e=r.gc().$implicit,t=r.gc().$implicit,i=r.gc();r.Oc(" ","number"===i.fieldType(t[e.field])?r.ic(1,1,t[e.field]):t[e.field]," ")}}function oe(e,t){if(1&e&&(r.Vb(0,"td"),r.Vb(1,"span",41),r.Kc(2,le,3,4,"ng-container",42),r.Kc(3,se,2,3,"ng-template",null,43,r.Lc),r.Ub(),r.Ub()),2&e){const e=t.$implicit,i=r.Bc(4),n=r.gc().$implicit,l=r.gc();r.Eb(1),r.pc("title",n[e.field]),r.Eb(1),r.oc("ngIf",l.isCurrencyField(e.field)&&null!=n[e.field])("ngIfElse",i)}}function ce(e,t){if(1&e&&(r.Vb(0,"tr",40),r.Kc(1,oe,5,3,"td",37),r.Ub()),2&e){const e=t.$implicit,i=r.gc();r.oc("pSelectableRow",e),r.Eb(1),r.oc("ngForOf",i.columns)}}function ae(e,t){if(1&e&&(r.Vb(0,"div",44),r.Vb(1,"p"),r.Mc(2),r.Ub(),r.Ub()),2&e){const e=r.gc();r.Eb(2),r.Nc(e.noData)}}const re=function(){return{"margin-bottom":"20px"}},he=function(){return{"margin-right":"-10px"}},de=i("+yMW");let ge=(()=>{class e{constructor(e,t,i,l,s){this.rmanDealRfcstAnalysisVService=e,this.router=t,this.commonSharedService=i,this.notificationService=l,this.rmanLookupsVService=s,this.rmanDealRfcstAnalysisV=new ue,this.rmanDealRfcstAnalysisVSearch=new ue,this.isSerached=0,this.noData=de.noData,this.paginationOptions={},this.showAddColumns=!0,this.isSelectAllChecked=!0,this.showPaginator=!0,this.collapsed=!0,this.columns=[],this.isTCSelected=!0,this.isPeriodTypeSelected=!0,this.sourceTypesList=[],this.srcType="Q",this.hideColumnMenu=!0,this.showFilter=!1,this.paginationOptions={pageNumber:0,pageSize:10},this.router.events.subscribe(e=>{e instanceof n.c&&(this.arrIdK=e.url.split("/")[3])}),this.rmanLookupsVService.getAllRmanLookupsV(this.paginationOptions,{lookupTypeName:"FORECAST_DOCUMENT_TYPE"}).then(e=>{this.sourceTypesList=e.content.map(e=>({label:e.lookupCode,value:e.lookupDescription}))})}ngOnInit(){this.getDealForecastingView()}onToggleTCFC(){this.getDealForecastingView()}onTogglePeriodType(){this.getDealForecastingView()}checkIfStringStartsWith(e,t){return t.some(t=>e.startsWith(t)||e.endsWith(t))}getTableColumns(e,t){this.isSelectAllChecked=!0;const i=["Q1-","Q2-","Q3-","Q4-","-Q1","-Q2","-Q3","-Q4","Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"];this.commonSharedService.getConfiguredColDetails(e,t).then(e=>{if(e&&null!=e&&e.userId){this.columns=[];let t=e.tableColumns.split(",");t.length>0&&t.forEach((e,t)=>{e&&(this.startIndex=this.globalCols.findIndex(t=>t.field==e),this.onDrop(t))}),this.globalCols.forEach(t=>{-1!==e.tableColumns.indexOf(t.field)||1==this.checkIfStringStartsWith(t.field,i)?this.columns.push(t):t.showField=!1}),this.columns.length!=this.globalCols.length&&(this.isSelectAllChecked=!1),this.showPaginator=0!==this.columns.length,this.userId=e.userId}else this.columns=this.globalCols}).catch(()=>{this.notificationService.showError("Error occured while getting table columns data"),this.loading=!1})}saveColumns(){let e="";this.showAddColumns=!this.showAddColumns;const t=this.globalCols.length-1;this.globalCols.forEach((i,n)=>{i.showField&&0==this.checkIfStringStartsWith(i.field,["Q1-","Q2-","Q3-","Q4-","-Q1","-Q2","-Q3","-Q4","Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"])&&(e+=i.field,n<t&&(e+=","))}),this.loading=!0;const i=this.getCurrentViewKey().concat(this.getPeriodTypeViewKey());this.commonSharedService.saveOrUpdateTableColumns("rmanDealForecastActualData_"+i,"Forecasting Analysis Details",e,this.userId).then(e=>{this.columns=this.globalCols.filter(e=>e.showField),this.userId=e.userId,this.showPaginator=0!==this.columns.length,this.loading=!1}).catch(()=>{this.notificationService.showError("Error occured while saving"),this.loading=!1})}onDragStart(e){this.startIndex=e}onDrop(e){const t=this.globalCols[this.startIndex];this.globalCols.splice(this.startIndex,1),this.globalCols.splice(e,0,t)}selectColumns(e){let t=this.globalCols.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}onSelectAll(){this.isSelectAllChecked=!this.isSelectAllChecked,this.globalCols.forEach(e=>{this.isSelectAllChecked?e.showField=!0:e.drag&&(e.showField=!1)})}onConfiguringColumns(e){this.clonedCols=JSON.parse(JSON.stringify(this.globalCols)),this.showAddColumns=!1}closeConfigureColumns(e){this.showAddColumns=!0,this.globalCols=this.clonedCols;let t=this.globalCols.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}isDealPage(){return this.router.url.includes("deal-manager")}reset(e){e.reset(),this.paginationOptions={},this.rmanDealRfcstAnalysisV=new ue,this.getDealForecastingView()}exportExcel(){let e=this.rmanDealRfcstAnalysisVService.getServiceUrl(this.paginationOptions,{arrangementId:this.arrIdK},1);window.location.href=e}getAllRmanDealRfcstAnalysisV(){this.loading=!0,this.rmanDealRfcstAnalysisVService.getAllRmanDealRfcstAnalysisV(this.paginationOptions,{arrangementId:this.arrIdK}).then(e=>{this.datasource=e.content,this.rmanDealRfcstAnalysisVList=e.content,this.loading=!1,this.totalElements=e.totalElements,this.pageSize=e.size,this.displaySearchDialog=!1}).catch(e=>{this.notificationService.showError("Error occured while getting data"),this.loading=!1})}onSourceTypeChange(){this.getDealForecastingView()}getDealForecastingView(){this.loading=!0,this.rmanDealRfcstAnalysisVService.getRmanForecastAnalysisView2(this.arrIdK,this.isTCSelected,this.isPeriodTypeSelected,this.srcType).then(e=>{this.rDealFCSTAnalysisViewList=e.Content,this.globalCols=[],this.loading=!1;let t=this.rDealFCSTAnalysisViewList[0];for(let n in t)["Element Type"].includes(n)||["Arrangement Number","SKU"].includes(n)||["Expected Booking Amount"].includes(n)?this.globalCols.push({field:n,header:n,hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Expected Start Date"].includes(n)?this.globalCols.push({field:n,header:"Forecast Date",hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Ayara Line Id"].includes(n)||["Quote Line Id"].includes(n)||(["Line No"].includes(n)?this.globalCols.push({field:n,header:"Line Number",hide:!1,showField:!0,drag:!0,display:"table-cell"}):["Parent Line No"].includes(n)?this.globalCols.push({field:n,header:"Parent Line Number",hide:!1,showField:!0,drag:!0,display:"table-cell"}):this.globalCols.push({field:n,header:n,hide:!1,showField:!0,drag:!0,display:"table-cell"}));this.columns=[];const i=this.getCurrentViewKey().concat(this.getPeriodTypeViewKey());this.getTableColumns("rmanDealForecastActualData_"+i,"Forecasting Analysis Details"),this.rDealFCSTAnalysisViewList=e.Content,this.totalRecords=this.rDealFCSTAnalysisViewList.length,$.unblockUI()}).catch(e=>{this.loading=!1,this.notificationService.showError("Error occured while getting data"),$.unblockUI()})}fieldType(e){return typeof e}showDialogToAdd(){this.newRmanDealRfcstAnalysisV=!0,this.rmanDealRfcstAnalysisV=new ue,this.displayDialog=!0}save(){this.newRmanDealRfcstAnalysisV?(this.loading=!0,this.rmanDealRfcstAnalysisVService.saveRmanDealRfcstAnalysisV(this.rmanDealRfcstAnalysisV).then(e=>{this.getAllRmanDealRfcstAnalysisV()}).catch(e=>{this.notificationService.showError("Error occured while saving the data"),this.loading=!1})):(this.loading=!0,this.rmanDealRfcstAnalysisVService.updateRmanDealRfcstAnalysisV(this.rmanDealRfcstAnalysisV).then(e=>{this.getAllRmanDealRfcstAnalysisV()}).catch(e=>{this.notificationService.showError("Error occured while updating the data"),this.loading=!1})),this.rmanDealRfcstAnalysisV=new ue,this.displayDialog=!1}delete(e){this.rmanDealRfcstAnalysisV=e,this.displayDialog=!1,window.confirm("Are you sure you want to delete this record?")&&(this.rmanDealRfcstAnalysisVList.splice(this.findSelectedRmanDealRfcstVIndex(),1),this.rmanDealRfcstAnalysisVService.deleteRmanDealRfcstV(this.rmanDealRfcstAnalysisV).then(e=>{this.rmanDealRfcstAnalysisV=new ue,this.getAllRmanDealRfcstAnalysisV()}))}editRow(e){this.newRmanDealRfcstAnalysisV=!1,this.rmanDealRfcstAnalysisV=this.cloneRmanDealRfcstV(e),this.displayDialog=!0}findSelectedRmanDealRfcstVIndex(){return this.rmanDealRfcstAnalysisVList.indexOf(this.selectedRmanDealRfcstAnalysisV)}onRowSelect(e){}cloneRmanDealRfcstV(e){let t=new ue;for(let i in e)t[i]=e[i];return t}toggleColumnMenu(){this.hideColumnMenu=!this.hideColumnMenu}toggleFilterBox(){this.showFilter=!this.showFilter}showDialogToSearch(){this.rmanDealRfcstAnalysisVSearch=new ue,0==this.isSerached&&(this.rmanDealRfcstAnalysisVSearch=new ue),this.displaySearchDialog=!0}search(){this.isSerached=1,this.rmanDealRfcstAnalysisV=this.rmanDealRfcstAnalysisVSearch,this.getAllRmanDealRfcstAnalysisV()}onBeforeToggle(e){this.collapsed=e.collapsed}isCurrencyField(e){return/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{2}$/.test(e)||/^\d{4}-Q[1-4]$/.test(e)}getCurrentViewKey(){return this.isTCSelected?"TC":"FC"}getPeriodTypeViewKey(){return this.isPeriodTypeSelected?"M":"Q"}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(j),r.Pb(n.g),r.Pb(s.a),r.Pb(l.a),r.Pb(a.a))},e.\u0275cmp=r.Jb({type:e,selectors:[["rmanDealRfcstAnalysisV-data"]],features:[r.Db([j,c.a])],decls:21,vars:17,consts:[[1,"content-section","implementation"],[3,"header","onBeforeToggle"],[1,"pull-right","icons-list"],["onLabel","Monthly","offLabel","Quarterly","onIcon","fa fa-toggle-on fa-sm","offIcon","fa fa-toggle-off fa-sm",1,"ui-inputswitch",3,"ngStyle","ngModel","ngModelChange"],["onLabel","TC","offLabel","FC","onIcon","fa fa-toggle-on fa-sm","offIcon","fa fa-toggle-off fa-sm",1,"ui-inputswitch",3,"ngStyle","ngModel","ngModelChange"],[1,"add-column",3,"click"],[1,"fa","fa-cog"],["title","Reset",3,"click"],[1,"fa","fa-refresh"],["title","Export",3,"click"],[1,"fa","fa-external-link"],["id","add-column-popup","class","contracts_add_column",4,"ngIf"],[1,"x-scroll"],["exportFilename","Forecast-Actual-comparision","columnResizeMode","expand","scrollable","true",1,"ui-datatable","arrangementMgrTbl",3,"columns","loading","value","paginator","rows","resizableColumns"],["dt",""],["pTemplate","colgroup"],["pTemplate","header","class","arrangementMgrTblHead"],["pTemplate","body"],["pTemplate","emptymessage"],["id","add-column-popup",1,"contracts_add_column"],[1,"user-popup",2,"left","344px"],[1,"content","overflow"],["type","checkbox","id","selectall","name","selectall",3,"checked","click"],["for","selectall"],["title","Close",1,"close",3,"click"],[3,"options"],["pTemplate","item"],[1,"pull-right"],[1,"configColBtn",3,"click"],[1,"configColBtn","conf-cancel",3,"click"],[4,"ngIf"],["pDraggable","gens","pDroppable","gens",1,"ui-helper-clearfix",3,"onDragStart","onDrop"],[1,"drag"],["type","checkbox",3,"checked","ngModel","ngModelChange","change"],[1,"ui-helper-clearfix"],["type","checkbox",3,"checked","ngModel","disabled","ngModelChange","change"],[3,"ngStyle"],[4,"ngFor","ngForOf"],["pResizableColumn","",4,"ngFor","ngForOf"],["pResizableColumn",""],[3,"pSelectableRow"],[3,"title"],[4,"ngIf","ngIfElse"],["normalText",""],[1,"no-results-data"]],template:function(e,t){if(1&e){const e=r.Wb();r.Qb(0,"div",0),r.Vb(1,"p-panel",1),r.dc("onBeforeToggle",(function(e){return t.onBeforeToggle(e)})),r.Vb(2,"p-header"),r.Vb(3,"div",2),r.Vb(4,"p-toggleButton",3),r.dc("ngModelChange",(function(e){return t.isPeriodTypeSelected=e}))("ngModelChange",(function(){return t.onTogglePeriodType()})),r.Ub(),r.Vb(5,"p-toggleButton",4),r.dc("ngModelChange",(function(e){return t.isTCSelected=e}))("ngModelChange",(function(){return t.onToggleTCFC()})),r.Ub(),r.Vb(6,"a",5),r.dc("click",(function(e){return t.onConfiguringColumns(e)})),r.Qb(7,"em",6),r.Mc(8,"Columns"),r.Ub(),r.Vb(9,"a",7),r.dc("click",(function(){r.Dc(e);const i=r.Bc(16);return t.reset(i)})),r.Qb(10,"em",8),r.Ub(),r.Vb(11,"a",9),r.dc("click",(function(){return r.Dc(e),r.Bc(16).exportCSV()})),r.Qb(12,"em",10),r.Ub(),r.Kc(13,G,15,5,"div",11),r.Ub(),r.Ub(),r.Vb(14,"div",12),r.Vb(15,"p-table",13,14),r.Kc(17,te,2,1,"ng-template",15),r.Kc(18,ne,2,1,"ng-template",16),r.Kc(19,ce,2,2,"ng-template",17),r.Kc(20,ae,3,1,"ng-template",18),r.Ub(),r.Ub(),r.Ub()}2&e&&(r.Eb(1),r.Ic(r.rc(14,re)),r.oc("header",t.isDealPage()?"":"Forecast-Actual comparision"),r.Eb(3),r.oc("ngStyle",r.rc(15,he))("ngModel",t.isPeriodTypeSelected),r.Eb(1),r.oc("ngStyle",r.rc(16,he))("ngModel",t.isTCSelected),r.Eb(8),r.oc("ngIf",!t.showAddColumns),r.Eb(2),r.oc("columns",t.columns)("loading",t.loading)("value",t.rDealFCSTAnalysisViewList)("paginator",!0)("rows",10)("resizableColumns",!0))},directives:[h.a,d.c,p.a,f.p,u.k,u.n,f.o,m.j,d.f,b.a,C.b,C.c,u.a,f.n,m.g,m.i],pipes:[D.a,V.a],encapsulation:2}),e})();class ue{constructor(e,t,i,n,l,s,o,c,a,r){this.glPeriod=e,this.expectedBookingAmount=t,this.amount=i,this.qty=n,this.netPrice=l,this.elementType=s,this.startDate=o,this.arrangementName=c,this.sku=a,this.arrangementId=r}}const fe=[{path:"viewForecasting",component:K},{path:"actualAnalysis",component:ge}];let pe=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},providers:[],imports:[[c.a,n.k.forChild(fe)],n.k]}),e})()}}]);