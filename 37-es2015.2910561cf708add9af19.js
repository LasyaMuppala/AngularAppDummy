(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{UAwC:function(e,t,i){"use strict";i.r(t),i.d(t,"RevenueSchedulesModule",(function(){return ge}));var n=i("tyNb"),c=i("PCNd"),o=i("JSOo"),s=i("J7oY"),l=i("fXoL"),r=i("tk/3");const a=i("+yMW");let h=(()=>{class e{constructor(e){this.http=e}setArrangementId(e){this.arrgId=e}getArrangementId(){return this.arrgId}getAllRevenueSchedules(e){return this.arrgId?this.http.get(a.apiUrl+"/actualRevenueScheduleReport?arrgId="+this.arrgId+"&currType="+(e?"TC":"FC"),{headers:{"Content-Type":"application/json",Accept:"application/json"},responseType:"json"}).toPromise().then(e=>{if(!e)return{content:[]};try{return{content:e.Content||[]}}catch(t){return{content:[]}}}).catch(e=>({content:[]})):Promise.resolve({content:[]})}}return e.\u0275fac=function(t){return new(t||e)(l.Zb(r.b))},e.\u0275prov=l.Lb({token:e,factory:e.\u0275fac}),e})();const u=i("+yMW");let d=(()=>{class e{constructor(e){this.http=e}getServiceUrl(e,t){return u.apiUrl+"/"+e+"?arrgId="+t}getAllRevenueSchedulesHistory(e){if(!e)return Promise.resolve({content:[]});let t=this.getServiceUrl("actualRevenueSchedulesHistory",e);return this.http.get(t,{headers:{"Content-Type":"application/json",Accept:"application/json"},responseType:"json"}).toPromise().then(e=>{if(!e)return{content:[]};try{return{content:e.Content||[]}}catch(t){return{content:e}}}).catch(e=>({content:[]}))}}return e.\u0275fac=function(t){return new(t||e)(l.Zb(r.b))},e.\u0275prov=l.Lb({token:e,factory:e.\u0275fac}),e})();var g=i("7CaW"),m=i("7zfz"),f=i("ofXK"),b=i("rEr+"),p=i("+07z"),v=i("TjhJ"),C=i("3Pt+"),S=i("fyqy");const y=["dt"];function w(e,t){if(1&e){const e=l.Wb();l.Vb(0,"a",16),l.dc("click",(function(){l.Dc(e);const t=l.gc(),i=l.Bc(13);return t.exportExcel(i)})),l.Qb(1,"em",17),l.Ub()}}function E(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",30),l.Vb(1,"div",31),l.dc("onDragStart",(function(){l.Dc(e);const t=l.gc().index;return l.gc(2).onDragStart(t)}))("onDrop",(function(){l.Dc(e);const t=l.gc().index;return l.gc(2).onDrop(t)})),l.Vb(2,"div",32),l.Vb(3,"input",33),l.dc("ngModelChange",(function(t){return l.Dc(e),l.gc().$implicit.showField=t}))("change",(function(){l.Dc(e);const t=l.gc().$implicit;return l.gc(2).selectColumns(t)})),l.Ub(),l.Vb(4,"label"),l.Mc(5),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc().$implicit;l.Eb(3),l.oc("checked",e.showField)("ngModel",e.showField),l.Eb(2),l.Nc(e.header)}}const k=function(){return{color:"grey"}};function x(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",30),l.Vb(1,"div",34),l.Vb(2,"div",30),l.Vb(3,"div",32),l.Vb(4,"input",35),l.dc("ngModelChange",(function(t){return l.Dc(e),l.gc().$implicit.showField=t}))("change",(function(){l.Dc(e);const t=l.gc().$implicit;return l.gc(2).selectColumns(t)})),l.Ub(),l.Vb(5,"label",36),l.Mc(6),l.Ub(),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc().$implicit;l.Eb(4),l.oc("checked",e.showField)("ngModel",e.showField)("disabled",!e.drag),l.Eb(1),l.oc("ngStyle",l.rc(5,k)),l.Eb(1),l.Nc(e.header)}}function U(e,t){if(1&e&&(l.Kc(0,E,6,3,"div",29),l.Kc(1,x,7,6,"div",29)),2&e){const e=t.$implicit;l.oc("ngIf",e.drag),l.Eb(1),l.oc("ngIf",!e.drag)}}const A=function(){return{width:"100%",height:"100%"}};function I(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",18),l.Vb(1,"div",19),l.Vb(2,"div",20),l.Vb(3,"input",21),l.dc("click",(function(){return l.Dc(e),l.gc().onSelectAll()})),l.Ub(),l.Vb(4,"label",22),l.Mc(5,"Select All"),l.Ub(),l.Vb(6,"a",23),l.dc("click",(function(t){return l.Dc(e),l.gc().closeConfigureColumns(t)})),l.Mc(7,"\xd7"),l.Ub(),l.Vb(8,"p-listbox",24),l.Kc(9,U,2,2,"ng-template",25),l.Ub(),l.Ub(),l.Vb(10,"div",26),l.Vb(11,"a",27),l.dc("click",(function(){return l.Dc(e),l.gc().saveColumns()})),l.Mc(12,"Save"),l.Ub(),l.Vb(13,"a",28),l.dc("click",(function(t){return l.Dc(e),l.gc().closeConfigureColumns(t)})),l.Mc(14,"Cancel"),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc();l.Eb(3),l.oc("checked",e.isSelectAllChecked),l.Eb(5),l.Ic(l.rc(4,A)),l.oc("options",e.revHistColumns)}}function D(e,t){1&e&&l.Qb(0,"col")}function V(e,t){if(1&e&&(l.Vb(0,"colgroup"),l.Kc(1,D,1,0,"col",37),l.Ub()),2&e){const e=t.$implicit;l.Eb(1),l.oc("ngForOf",e)}}const H=function(e,t){return{display:e,"text-align":t}};function M(e,t){if(1&e&&(l.Vb(0,"th",39),l.Mc(1),l.Ub()),2&e){const e=t.$implicit;l.oc("ngStyle",l.tc(2,H,e.display,e.text)),l.Eb(1),l.Oc(" ",e.header," ")}}function F(e,t){if(1&e&&(l.Vb(0,"tr"),l.Kc(1,M,2,5,"th",38),l.Ub()),2&e){const e=l.gc();l.Eb(1),l.oc("ngForOf",e.columns)}}function R(e,t){if(1&e&&(l.Vb(0,"span"),l.Mc(1),l.hc(2,"roundCurrency"),l.Ub()),2&e){const e=l.gc().$implicit,t=l.gc().$implicit;l.Eb(1),l.Oc(" ",l.jc(2,1,t[e.field],t.Currency)," ")}}function O(e,t){if(1&e&&(l.Mc(0),l.hc(1,"number")),2&e){const e=l.gc().$implicit,t=l.gc().$implicit,i=l.gc();l.Oc(" ","number"===i.fieldType(t[e.field])?l.jc(1,1,t[e.field],"1.2-2"):t[e.field]," ")}}function T(e,t){if(1&e&&(l.Vb(0,"td",39),l.Kc(1,R,3,4,"span",41),l.Kc(2,O,2,4,"ng-template",null,42,l.Lc),l.Ub()),2&e){const e=t.$implicit,i=l.Bc(3),n=l.gc().$implicit,c=l.gc();l.oc("ngStyle",l.tc(3,H,e.display,e.text)),l.Eb(1),l.oc("ngIf",c.isCurrencyField(e.field)&&null!=n[e.field])("ngIfElse",i)}}function N(e,t){if(1&e&&(l.Vb(0,"tr",40),l.Kc(1,T,4,6,"td",38),l.Ub()),2&e){const e=t.$implicit,i=l.gc();l.oc("pSelectableRow",e),l.Eb(1),l.oc("ngForOf",i.columns)}}function K(e,t){if(1&e&&(l.Vb(0,"div",43),l.Vb(1,"p"),l.Mc(2),l.Ub(),l.Ub()),2&e){const e=l.gc();l.Eb(2),l.Nc(e.noData)}}const $=i("+yMW");let P=(()=>{class e{constructor(e,t,i,n){this.rmanRevenueSchedulesHistoryService=e,this.commonSharedService=t,this.notificationService=i,this.router=n,this.noData=$.noData,this.loading=!0,this.revenueSchedulesHistoryList=[],this.columns=[],this.pageSize=10,this.totalElements=0,this.pageNumber=0,this.isTCSelected=!0,this.showAddColumns=!0,this.isSelectAllChecked=!0,this.showPaginator=!0,this.disableExport=!0}ngOnInit(){this.columns=[]}ngOnDestroy(){this.columns=[]}getTableColumns(e,t){this.isSelectAllChecked=!0,this.commonSharedService.getConfiguredColDetails(e,t).then(e=>{if(e&&null!=e&&e.userId){this.columns=[];let t=e.tableColumns.split(",");t.length>0&&t.forEach((e,t)=>{e&&(this.startIndex=this.revHistColumns.findIndex(t=>t.field==e),this.onDrop(t))}),this.revHistColumns.forEach(e=>{-1!==t.indexOf(e.field)||1==this.checkIfStringStartsWith(e.field)?this.columns.push(e):e.showField=!1}),this.columns.length!=this.revHistColumns.length&&(this.isSelectAllChecked=!1),this.showPaginator=0!==this.columns.length,this.userId=e.userId}else this.columns=this.revHistColumns;void 0===this.columns&&(this.columns=this.revHistColumns)}).catch(e=>{this.notificationService.showError("Error occurred while getting table columns data"),this.loading=!1,this.columns=this.revHistColumns})}checkIfStringStartsWith(e){return["Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"].some(t=>e.startsWith(t))}getAllRevenueSchedulesHistory(){if(!this.arrgId)return this.loading=!1,void this.notificationService.showError("Network failed / service is down.");this.loading=!0,this.rmanRevenueSchedulesHistoryService.getAllRevenueSchedulesHistory(this.arrgId).then(e=>{var t;if(!e)return this.loading=!1,void this.notificationService.showError("Error occurred while getting data");const i=e.content||[];let n=i[0];const c=Object.values(n).every(e=>null==e);if(this.totalElements=c?0:i.length||0,i.length>0){this.revHistColumns=[];for(let t in n)this.revHistColumns.push({field:t,header:t,display:"table-cell",text:"right",drag:!this.checkIfStringStartsWith(t),showField:!0});let e=["Product Name"];for(let t=0;t<this.revHistColumns.length;t++)this.revHistColumns[t].text=-1==e.indexOf(this.revHistColumns[t].header)?"right":"left";this.revenueSchedulesHistoryList=c?[]:i,this.getTableColumns("rmanRevenueSchedulesHistory","Revenue Schedules History"),this.clonedCols=this.columns,this.currencyCode=null!==(t=n["Currency Code"])&&void 0!==t?t:"USD",this.disableExport=!!c}this.loading=!1}).catch(e=>{this.notificationService.showError("Error occurred while getting data"),this.loading=!1})}toTitleCase(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}clearAllRevenueSchedulesHistory(){this.revenueSchedulesHistoryList=[],this.totalElements=0}onPageChange(e){this.arrgId&&(this.pageNumber=e.first/e.rows,this.getAllRevenueSchedulesHistory())}saveColumns(){let e="";this.showAddColumns=!this.showAddColumns;const t=this.revHistColumns.length-1;this.revHistColumns.forEach((i,n)=>{i.showField&&0==this.checkIfStringStartsWith(i.field)&&(e+=i.field,n<t&&(e+=","))}),this.loading=!0,this.commonSharedService.saveOrUpdateTableColumns("rmanRevenueSchedulesHistory","Revenue Schedules History",e,this.userId).then(e=>{this.columns=this.revHistColumns.filter(e=>e.showField),this.userId=e.userId,this.showPaginator=0!==this.columns.length,this.loading=!1}).catch(()=>{this.notificationService.showError("Error occurred while saving columns"),this.loading=!1}),this.clonedCols=this.columns}onDragStart(e){this.startIndex=e}onDrop(e){const t=this.revHistColumns[this.startIndex];this.startIndex>=0&&(this.revHistColumns.splice(this.startIndex,1),this.revHistColumns.splice(e,0,t));const i=this.columns.map(e=>e.field);this.columns=this.revHistColumns.filter(e=>i.includes(e.field))}selectColumns(e){let t=this.revHistColumns.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}onSelectAll(){this.isSelectAllChecked=!this.isSelectAllChecked,this.revHistColumns.forEach(e=>{this.isSelectAllChecked?e.showField=!0:e.drag&&(e.showField=!1)})}onConfiguringColumns(e){this.clonedCols=JSON.parse(JSON.stringify(this.revHistColumns)),this.showAddColumns=!1}closeConfigureColumns(e){this.showAddColumns=!0,this.revHistColumns=this.clonedCols;let t=this.revHistColumns.filter(e=>e.showField);this.isSelectAllChecked=t.length==this.revHistColumns.length,this.columns=t}exportExcel(){this.dt?this.dt.exportCSV():this.notificationService.showError("Error while Exporting")}reset(e){this.arrgId?(this.getAllRevenueSchedulesHistory(),e.clear()):this.notificationService.showError("Network failed / service is down.")}fieldType(e){["Revenue Contract Number","POB ID","Quantity"].indexOf(e)}isCurrencyField(e){return["Unit Net Price","Net Price","Allocation Amount"].includes(e)||/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{2}$/.test(e)}isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Pb(d),l.Pb(o.a),l.Pb(s.a),l.Pb(n.g))},e.\u0275cmp=l.Jb({type:e,selectors:[["rmanRevenueSchedulesHistory-data"]],viewQuery:function(e,t){var i;1&e&&l.Qc(y,!0),2&e&&l.Ac(i=l.ec())&&(t.dt=i.first)},features:[l.Db([d])],decls:18,vars:10,consts:[[1,"content-section","implementation"],["header","",1,"mb-1em"],[1,"pull-right","icons-list"],[1,"add-column",3,"click"],[1,"fa","fa-cog"],["title","Reset",3,"click"],[1,"fa","fa-refresh"],["title","Export",3,"click",4,"ngIf"],["id","add-column-popup","class","contracts_add_column",4,"ngIf"],[1,"x-scroll"],["id","revenueSchedulesHistory-dt","scrollable","true","selectionMode","single","exportFilename","Actual Revenue Schedules History",1,"ui-datatable","arrangementMgrTbl",3,"value","loading","rows","totalRecords","columns","lazy","paginator","metaKeySelection"],["dt",""],["pTemplate","colgroup"],["pTemplate","header","class","arrangementMgrTblHead"],["pTemplate","body"],["pTemplate","emptymessage"],["title","Export",3,"click"],[1,"fa","fa-external-link"],["id","add-column-popup",1,"contracts_add_column"],[1,"user-popup"],[1,"content","overflow"],["type","checkbox","id","selectall","name","selectall",2,"width","13px !important",3,"checked","click"],["for","selectall"],["title","Close",1,"close",3,"click"],[3,"options"],["pTemplate","item"],[1,"pull-right"],[1,"configColBtn",3,"click"],[1,"configColBtn","conf-cancel",3,"click"],["style","display:flex; width: 100% !important",4,"ngIf"],[2,"display","flex","width","100% !important"],["pDraggable","gens","pDroppable","gens",1,"ui-helper-clearfix",2,"width","100%",3,"onDragStart","onDrop"],[1,"drag",2,"width","100% !important"],["type","checkbox",2,"width","13px !important",3,"checked","ngModel","ngModelChange","change"],[1,"ui-helper-clearfix",2,"width","100%"],["type","checkbox",2,"width","13px !important",3,"checked","ngModel","disabled","ngModelChange","change"],[3,"ngStyle"],[4,"ngFor","ngForOf"],["style","width: 150px;",3,"ngStyle",4,"ngFor","ngForOf"],[2,"width","150px",3,"ngStyle"],[3,"pSelectableRow"],[4,"ngIf","ngIfElse"],["normalText",""],[1,"no-results-data"]],template:function(e,t){if(1&e){const e=l.Wb();l.Qb(0,"div",0),l.Vb(1,"p-panel",1),l.Vb(2,"p-header"),l.Vb(3,"div",2),l.Vb(4,"a",3),l.dc("click",(function(e){return t.onConfiguringColumns(e)})),l.Qb(5,"em",4),l.Mc(6,"Columns"),l.Ub(),l.Vb(7,"a",5),l.dc("click",(function(){l.Dc(e);const i=l.Bc(13);return t.reset(i)})),l.Qb(8,"em",6),l.Ub(),l.Kc(9,w,2,0,"a",7),l.Kc(10,I,15,5,"div",8),l.Ub(),l.Ub(),l.Vb(11,"div",9),l.Vb(12,"p-table",10,11),l.Kc(14,V,2,1,"ng-template",12),l.Kc(15,F,2,1,"ng-template",13),l.Kc(16,N,2,2,"ng-template",14),l.Kc(17,K,3,1,"ng-template",15),l.Ub(),l.Ub(),l.Ub()}2&e&&(l.Eb(9),l.oc("ngIf",!t.disableExport),l.Eb(1),l.oc("ngIf",!t.showAddColumns),l.Eb(2),l.oc("value",t.revenueSchedulesHistoryList)("loading",t.loading)("rows",t.pageSize)("totalRecords",t.totalElements)("columns",t.columns)("lazy",!1)("paginator",!0)("metaKeySelection",!1))},directives:[g.a,m.c,f.o,b.j,m.f,p.a,v.b,v.c,C.a,C.k,C.n,f.p,f.n,b.i],pipes:[S.a,f.g],encapsulation:2}),e})();var J=i("Y+ZO"),W=i("/RsI");const L=["dt"],Q=["revHistory"];function j(e,t){if(1&e){const e=l.Wb();l.Vb(0,"a",22),l.dc("click",(function(){l.Dc(e);const t=l.gc(),i=l.Bc(17);return t.exportExcel(i)})),l.Qb(1,"em",23),l.Ub()}}function z(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",36),l.Vb(1,"div",37),l.dc("onDragStart",(function(){l.Dc(e);const t=l.gc().index;return l.gc(2).onDragStart(t)}))("onDrop",(function(){l.Dc(e);const t=l.gc().index;return l.gc(2).onDrop(t)})),l.Vb(2,"div",38),l.Vb(3,"input",39),l.dc("ngModelChange",(function(t){return l.Dc(e),l.gc().$implicit.showField=t}))("change",(function(){l.Dc(e);const t=l.gc().$implicit;return l.gc(2).selectColumns(t)})),l.Ub(),l.Vb(4,"label"),l.Mc(5),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc().$implicit;l.Eb(3),l.oc("checked",e.showField)("ngModel",e.showField),l.Eb(2),l.Nc(e.header)}}const B=function(){return{color:"grey"}};function _(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",36),l.Vb(1,"div",40),l.Vb(2,"div",36),l.Vb(3,"div",38),l.Vb(4,"input",41),l.dc("ngModelChange",(function(t){return l.Dc(e),l.gc().$implicit.showField=t}))("change",(function(){l.Dc(e);const t=l.gc().$implicit;return l.gc(2).selectColumns(t)})),l.Ub(),l.Vb(5,"label",42),l.Mc(6),l.Ub(),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc().$implicit;l.Eb(4),l.oc("checked",e.showField)("ngModel",e.showField)("disabled",!e.drag),l.Eb(1),l.oc("ngStyle",l.rc(5,B)),l.Eb(1),l.Nc(e.header)}}function Z(e,t){if(1&e&&(l.Kc(0,z,6,3,"div",35),l.Kc(1,_,7,6,"div",35)),2&e){const e=t.$implicit;l.oc("ngIf",e.drag),l.Eb(1),l.oc("ngIf",!e.drag)}}const X=function(){return{width:"100%",height:"100%"}};function Y(e,t){if(1&e){const e=l.Wb();l.Vb(0,"div",24),l.Vb(1,"div",25),l.Vb(2,"div",26),l.Vb(3,"input",27),l.dc("click",(function(){return l.Dc(e),l.gc().onSelectAll()})),l.Ub(),l.Vb(4,"label",28),l.Mc(5,"Select All"),l.Ub(),l.Vb(6,"a",29),l.dc("click",(function(t){return l.Dc(e),l.gc().closeConfigureColumns(t)})),l.Mc(7,"\xd7"),l.Ub(),l.Vb(8,"p-listbox",30),l.Kc(9,Z,2,2,"ng-template",31),l.Ub(),l.Ub(),l.Vb(10,"div",32),l.Vb(11,"a",33),l.dc("click",(function(){return l.Dc(e),l.gc().saveColumns()})),l.Mc(12,"Save"),l.Ub(),l.Vb(13,"a",34),l.dc("click",(function(t){return l.Dc(e),l.gc().closeConfigureColumns(t)})),l.Mc(14,"Cancel"),l.Ub(),l.Ub(),l.Ub(),l.Ub()}if(2&e){const e=l.gc();l.Eb(3),l.oc("checked",e.isSelectAllChecked),l.Eb(5),l.Ic(l.rc(4,X)),l.oc("options",e.revColumns)}}function q(e,t){1&e&&l.Qb(0,"col")}function G(e,t){if(1&e&&(l.Vb(0,"colgroup"),l.Kc(1,q,1,0,"col",43),l.Ub()),2&e){const e=t.$implicit;l.Eb(1),l.oc("ngForOf",e)}}const ee=function(e,t){return{display:e,"text-align":t}};function te(e,t){if(1&e&&(l.Vb(0,"th",45),l.Mc(1),l.Ub()),2&e){const e=t.$implicit;l.oc("ngStyle",l.tc(2,ee,e.display,e.text)),l.Eb(1),l.Oc(" ",e.header," ")}}function ie(e,t){if(1&e&&(l.Vb(0,"tr"),l.Kc(1,te,2,5,"th",44),l.Ub()),2&e){const e=l.gc();l.Eb(1),l.oc("ngForOf",e.columns)}}function ne(e,t){if(1&e&&(l.Vb(0,"span"),l.Mc(1),l.hc(2,"roundCurrency"),l.Ub()),2&e){const e=l.gc().$implicit,t=l.gc().$implicit;l.Eb(1),l.Oc(" ",l.jc(2,1,t[e.field],t["Currency Code"])," ")}}function ce(e,t){if(1&e&&(l.Mc(0),l.hc(1,"number")),2&e){const e=l.gc().$implicit,t=l.gc().$implicit,i=l.gc();l.Oc(" ","number"===i.fieldType(t[e.field])?l.jc(1,1,t[e.field],"1.2-2"):t[e.field]," ")}}function oe(e,t){if(1&e&&(l.Vb(0,"td",45),l.Kc(1,ne,3,4,"span",47),l.Kc(2,ce,2,4,"ng-template",null,48,l.Lc),l.Ub()),2&e){const e=t.$implicit,i=l.Bc(3),n=l.gc().$implicit,c=l.gc();l.oc("ngStyle",l.tc(3,ee,e.display,e.text)),l.Eb(1),l.oc("ngIf",c.isCurrencyField(e.field)&&null!=n[e.field])("ngIfElse",i)}}function se(e,t){if(1&e&&(l.Vb(0,"tr",46),l.Kc(1,oe,4,6,"td",44),l.Ub()),2&e){const e=t.$implicit,i=l.gc();l.oc("pSelectableRow",e),l.Eb(1),l.oc("ngForOf",i.columns)}}function le(e,t){if(1&e&&(l.Vb(0,"td",51),l.Mc(1),l.hc(2,"roundCurrency"),l.Ub()),2&e){const e=t.$implicit,i=l.gc(3);l.oc("ngStyle",l.tc(5,ee,e.display,e.text)),l.Eb(1),l.Oc(" ",i.totals&&null!=i.totals[e.field]?l.jc(2,2,i.totals[e.field],i.currencyCode):""," ")}}function re(e,t){if(1&e&&(l.Vb(0,"tr"),l.Kc(1,le,3,8,"td",50),l.Ub()),2&e){const e=l.gc(2);l.Eb(1),l.oc("ngForOf",e.columns)}}function ae(e,t){if(1&e&&l.Kc(0,re,2,1,"tr",49),2&e){const e=l.gc();l.oc("ngIf",e.revenueSchedulesList&&e.revenueSchedulesList.length>0)}}function he(e,t){if(1&e&&(l.Vb(0,"div",52),l.Vb(1,"p"),l.Mc(2),l.Ub(),l.Ub()),2&e){const e=l.gc();l.Eb(2),l.Nc(e.noData)}}const ue=i("+yMW"),de=[{path:"",component:(()=>{class e{constructor(e,t,i,c){this.rmanRevenueSchedulesService=e,this.commonSharedService=t,this.notificationService=i,this.router=c,this.noData=ue.noData,this.loading=!0,this.historyDialog=!1,this.revenueSchedulesList=[],this.pageSize=10,this.totalElements=0,this.isTCSelected=!0,this.totals={},this.showAddColumns=!0,this.isSelectAllChecked=!0,this.showPaginator=!0,this.exportCols=[],this.disableExport=!0;const o=c.url.split("/")[3];o&&this.rmanRevenueSchedulesService.setArrangementId(o),this.router.events.subscribe(e=>{if(e instanceof n.c){const t=e.url.split("/")[3];t&&this.rmanRevenueSchedulesService.setArrangementId(t)}})}ngOnInit(){this.arrgId=this.rmanRevenueSchedulesService.getArrangementId(),this.arrgId||this.notificationService.showError("No arrangement ID found. Please select a valid arrangement."),this.columns=[],this.getAllRevenueSchedules()}getTableColumns(e,t){this.isSelectAllChecked=!0;const i=["Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"];this.commonSharedService.getConfiguredColDetails(e,t).then(e=>{if(e&&null!=e&&e.userId){this.columns=[];let t=e.tableColumns.split(",");t.length>0&&t.forEach((e,t)=>{e&&(this.startIndex=this.revColumns.findIndex(t=>t.field==e),this.onDrop(t))}),this.revColumns.forEach(e=>{-1!==t.indexOf(e.field)||1==this.checkIfStringStartsWith(e.field,i)?this.columns.push(e):e.showField=!1}),this.columns.length!=this.revColumns.length&&(this.isSelectAllChecked=!1),this.showPaginator=0!==this.columns.length,this.userId=e.userId}else this.columns=this.revColumns;0===this.columns.length&&(this.columns=this.revColumns)}).catch(e=>{this.notificationService.showError("Error occurred while getting table columns data"),this.loading=!1,this.columns=this.revColumns})}checkIfStringStartsWith(e,t){return["Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"].some(t=>e.startsWith(t))}getAllRevenueSchedules(){if(!this.rmanRevenueSchedulesService.getArrangementId())return this.loading=!1,void this.notificationService.showError("Network failed / service is down.");this.loading=!0,this.rmanRevenueSchedulesService.getAllRevenueSchedules(this.isTCSelected).then(e=>{var t;if(!e)return this.loading=!1,void this.notificationService.showError("Error occurred while getting data");const i=e.content||[];let n=i[0];const c=Object.values(n).every(e=>null==e);if(this.totalElements=c?0:i.length||0,i.length>0){this.revColumns=[];for(let t in n)this.revColumns.push({field:t,header:t,display:"table-cell",text:"right",drag:!this.checkIfStringStartsWith(t,null),showField:!0});let e=["Product Name"];for(let t=0;t<this.revColumns.length;t++)this.revColumns[t].text=-1==e.indexOf(this.revColumns[t].header)?"right":"left";this.revenueSchedulesList=c?[]:i,this.getTableColumns("rmanRevenueSchedules","Revenue Schedules"),this.clonedCols=this.columns,this.calculateTotals(),this.currencyCode=null!==(t=n["Currency Code"])&&void 0!==t?t:"USD",this.disableExport=!!c}this.loading=!1}).catch(e=>{this.notificationService.showError("Error occurred while getting data"),this.loading=!1})}onPageChange(e){this.pageSize=e.rows}calculateTotals(){const e=["Deal Line Number","Product Reference Id","Quote Line Number","Quote Number","Quote Reference Id","Revenue Contract Number","Revenue Term in Days","Revenue Term in Months","Assset ID","Order Number","Order Line Number","Parent Line Number"];this.revColumns.forEach(t=>{e.includes(t.header)||(this.totals[t.field]=null)}),this.revenueSchedulesList.forEach(t=>{this.revColumns.forEach(i=>{if(!e.includes(i.header)){const e=t[i.field];this.isNumber(e)&&(this.totals[i.field]+=parseFloat(e))}})})}saveColumns(){let e="";this.showAddColumns=!this.showAddColumns;const t=this.revColumns.length-1;this.revColumns.forEach((i,n)=>{i.showField&&0==this.checkIfStringStartsWith(i.field,["Jan-","Feb-","Mar-","Apr-","May-","Jun-","Jul-","Aug-","Sep-","Oct-","Nov-","Dec-","Future"])&&(e+=i.field,n<t&&(e+=","))}),this.loading=!0,this.commonSharedService.saveOrUpdateTableColumns("rmanRevenueSchedules","Revenue Schedules",e,this.userId).then(e=>{this.columns=this.revColumns.filter(e=>e.showField),this.userId=e.userId,this.showPaginator=0!==this.columns.length,this.loading=!1}).catch(()=>{this.notificationService.showError("Error occurred while saving columns"),this.loading=!1}),this.clonedCols=this.columns}onDragStart(e){this.startIndex=e}onDrop(e){const t=this.revColumns[this.startIndex];this.startIndex>=0&&(this.revColumns.splice(this.startIndex,1),this.revColumns.splice(e,0,t));const i=this.columns.map(e=>e.field);this.columns=this.revColumns.filter(e=>i.includes(e.field))}selectColumns(e){let t=this.revColumns.filter(e=>!e.showField);this.isSelectAllChecked=!(t.length>0)}onSelectAll(){this.isSelectAllChecked=!this.isSelectAllChecked,this.revColumns.forEach(e=>{this.isSelectAllChecked?e.showField=!0:e.drag&&(e.showField=!1)})}onConfiguringColumns(e){this.clonedCols=JSON.parse(JSON.stringify(this.revColumns)),this.showAddColumns=!1}closeConfigureColumns(e){this.showAddColumns=!0,this.revColumns=this.clonedCols;let t=this.revColumns.filter(e=>e.showField);this.isSelectAllChecked=t.length==this.revColumns.length,this.columns=t}exportExcel(){this.dt?this.dt.exportCSV():this.notificationService.showError("Error while Exporting")}reset(e){this.rmanRevenueSchedulesService.getArrangementId()?(this.getAllRevenueSchedules(),e.clear()):this.notificationService.showError("Network failed / service is down.")}fieldType(e){return typeof e}isCurrencyField(e){return["Unit Net Price","Net Price","Allocation Amount","Line Amount","Delivered Line Amount","Delivered Alloc Amount","To be delivered - Line amount","To be delivered - Allocation amount"].includes(e)||/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{2}$/.test(e)}isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}getHistory(){this.historyDialog=!0}onHistoryDialogOpen(){this.revHistoryComp&&(this.revHistoryComp.arrgId=this.arrgId,this.revHistoryComp.getTableColumns("rmanRevenueSchedulesHistory","Revenue Schedules History"),this.revHistoryComp.getAllRevenueSchedulesHistory())}onHistoryDialogClose(){this.historyDialog=!1,this.revHistoryComp.clearAllRevenueSchedulesHistory()}}return e.\u0275fac=function(t){return new(t||e)(l.Pb(h),l.Pb(o.a),l.Pb(s.a),l.Pb(n.g))},e.\u0275cmp=l.Jb({type:e,selectors:[["rmanRevenueSchedules-data"]],viewQuery:function(e,t){var i;1&e&&(l.Qc(L,!0),l.Qc(Q,!0)),2&e&&(l.Ac(i=l.ec())&&(t.dt=i.first),l.Ac(i=l.ec())&&(t.revHistoryComp=i.first))},features:[l.Db([h])],decls:26,vars:14,consts:[[1,"content-section","implementation"],["header","Actual Revenue Schedules",1,"mb-1em"],[1,"pull-right","icons-list"],["onLabel","TC","offLabel","FC","onIcon","fa fa-toggle-on fa-sm","offIcon","fa fa-toggle-off fa-sm",1,"ui-inputswitch",3,"ngModel","ngModelChange"],[1,"add-column",3,"click"],[1,"fa","fa-cog"],["title","History",1,"add-column",3,"click"],[1,"fa","fa-history"],["title","Reset",3,"click"],[1,"fa","fa-refresh"],["title","Export",3,"click",4,"ngIf"],["id","add-column-popup","class","contracts_add_column",4,"ngIf"],[1,"x-scroll"],["id","actualRevSchedules-dt","scrollable","true","selectionMode","single","exportFilename","Actual Revenue Schedules",1,"ui-datatable","arrangementMgrTbl",3,"value","loading","rows","totalRecords","columns","lazy","paginator","metaKeySelection"],["dt",""],["pTemplate","colgroup"],["pTemplate","header","class","arrangementMgrTblHead"],["pTemplate","body"],["pTemplate","footer"],["pTemplate","emptymessage"],["header","Revenue Schedules History","id","journals","width","1300","showEffect","fade",1,"accounting-dialog",3,"visible","draggable","modal","visibleChange","onShow","onHide"],["revHistory",""],["title","Export",3,"click"],[1,"fa","fa-external-link"],["id","add-column-popup",1,"contracts_add_column"],[1,"user-popup"],[1,"content","overflow"],["type","checkbox","id","selectall","name","selectall",2,"width","13px !important",3,"checked","click"],["for","selectall"],["title","Close",1,"close",3,"click"],[3,"options"],["pTemplate","item"],[1,"pull-right"],[1,"configColBtn",3,"click"],[1,"configColBtn","conf-cancel",3,"click"],["style","display:flex; width: 100% !important",4,"ngIf"],[2,"display","flex","width","100% !important"],["pDraggable","gens","pDroppable","gens",1,"ui-helper-clearfix",2,"width","100%",3,"onDragStart","onDrop"],[1,"drag",2,"width","100% !important"],["type","checkbox",2,"width","13px !important",3,"checked","ngModel","ngModelChange","change"],[1,"ui-helper-clearfix",2,"width","100%"],["type","checkbox",2,"width","13px !important",3,"checked","ngModel","disabled","ngModelChange","change"],[3,"ngStyle"],[4,"ngFor","ngForOf"],["style","width: 150px;",3,"ngStyle",4,"ngFor","ngForOf"],[2,"width","150px",3,"ngStyle"],[3,"pSelectableRow"],[4,"ngIf","ngIfElse"],["normalText",""],[4,"ngIf"],["style","padding-right: 4px !important",3,"ngStyle",4,"ngFor","ngForOf"],[2,"padding-right","4px !important",3,"ngStyle"],[1,"no-results-data"]],template:function(e,t){if(1&e){const e=l.Wb();l.Qb(0,"div",0),l.Vb(1,"p-panel",1),l.Vb(2,"p-header"),l.Vb(3,"div",2),l.Vb(4,"p-toggleButton",3),l.dc("ngModelChange",(function(e){return t.isTCSelected=e}))("ngModelChange",(function(){return t.getAllRevenueSchedules()})),l.Ub(),l.Vb(5,"a",4),l.dc("click",(function(e){return t.onConfiguringColumns(e)})),l.Qb(6,"em",5),l.Mc(7,"Columns"),l.Ub(),l.Vb(8,"a",6),l.dc("click",(function(){return t.getHistory()})),l.Qb(9,"em",7),l.Mc(10,"History"),l.Ub(),l.Vb(11,"a",8),l.dc("click",(function(){l.Dc(e);const i=l.Bc(17);return t.reset(i)})),l.Qb(12,"em",9),l.Ub(),l.Kc(13,j,2,0,"a",10),l.Kc(14,Y,15,5,"div",11),l.Ub(),l.Ub(),l.Vb(15,"div",12),l.Vb(16,"p-table",13,14),l.Kc(18,G,2,1,"ng-template",15),l.Kc(19,ie,2,1,"ng-template",16),l.Kc(20,se,2,2,"ng-template",17),l.Kc(21,ae,1,1,"ng-template",18),l.Kc(22,he,3,1,"ng-template",19),l.Ub(),l.Ub(),l.Ub(),l.Vb(23,"p-dialog",20),l.dc("visibleChange",(function(e){return t.historyDialog=e}))("onShow",(function(){return t.onHistoryDialogOpen()}))("onHide",(function(){return t.onHistoryDialogClose()})),l.Qb(24,"rmanRevenueSchedulesHistory-data",null,21),l.Ub()}2&e&&(l.Eb(4),l.oc("ngModel",t.isTCSelected),l.Eb(9),l.oc("ngIf",!t.disableExport),l.Eb(1),l.oc("ngIf",!t.showAddColumns),l.Eb(2),l.oc("value",t.revenueSchedulesList)("loading",t.loading)("rows",t.pageSize)("totalRecords",t.totalElements)("columns",t.columns)("lazy",!1)("paginator",!0)("metaKeySelection",!1),l.Eb(7),l.oc("visible",t.historyDialog)("draggable",!0)("modal",!0))},directives:[g.a,m.c,J.a,C.k,C.n,f.o,b.j,m.f,W.a,P,p.a,v.b,v.c,C.a,f.p,f.n,b.i],pipes:[S.a,f.g],encapsulation:2}),e})()}];let ge=(()=>{class e{}return e.\u0275mod=l.Nb({type:e}),e.\u0275inj=l.Mb({factory:function(t){return new(t||e)},providers:[],imports:[[c.a,n.k.forChild(de)],n.k]}),e})()}}]);